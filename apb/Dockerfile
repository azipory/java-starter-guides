FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHN0YXJ0ZXItd29ya3Nob3AtYXBiCmRlc2NyaXB0aW9uOiBBUEIg\
dG8gZGVwbG95IHJlcXVpcmVkIGluZnJhIGNvbXBvbmVudHMgZm9yIHRoZSBEZXZlbG9wZXIgU3Rh\
cnRlciBXb3Jrc2hvcCBvbiBhbiBPcGVuU2hpZnQgY2x1c3RlcgpiaW5kYWJsZTogRmFsc2UKYXN5\
bmM6IG9wdGlvbmFsCnRhZ3M6Ci0gd29ya3Nob3AKbWV0YWRhdGE6CiAgZGVwZW5kZW5jaWVzOiBb\
J2RvY2tlci5pby9vc2V2Zy93b3Jrc2hvcHBlcjpsYXRlc3QnLCdkb2NrZXIuaW8vb3BlbnNoaWZ0\
ZGVtb3MvZ29nczowLjExLjM0JywncXVheS5pby93a3VsaGFuZWsvZXRoZXJwYWQ6MS42LjUnLCdk\
b2NrZXIuaW8vc29uYXR5cGUvbmV4dXMzOjMuMTEuMCddCiAgZGlzcGxheU5hbWU6ICJPcGVuU2hp\
ZnQgRGV2ZWxvcGVyIFN0YXJ0ZXIgV29ya3Nob3AgSW5zdGFsbGVyIgogIGxvbmdEZXNjcmlwdGlv\
bjogfC0KICAgIEluc3RhbGxzIHRoZSBsYWIgaW5zdHJ1Y3Rpb25zIGFuZCByZXF1aXJlZCBjb21w\
b25lbnRzCiAgICAtIEdvZ3Mgc2VydmVyCiAgICAtIE5leHVzCiAgICAtIEV0aGVycGFkCiAgICAt\
IExhYiBHdWlkZXMKICAgIC0gRWNsaXBzZSBDaGUKICAgIGZvciBydW5uaW5nIHRoZSBHZXR0aW5n\
IHN0YXJ0ZXIgZGV2ZWxvcGluZyBvbiBPcGVuU2hpZnQgV29ya3Nob3AgaHR0cHM6Ly9naXRodWIu\
Y29tL29wZW5zaGlmdC1sYWJzL3N0YXJ0ZXItZ3VpZGVzCiAgY29uc29sZS5vcGVuc2hpZnQuaW8v\
aWNvbkNsYXNzOiAicGZpY29uIHBmaWNvbi1wcm9jZXNzLWF1dG9tYXRpb24iCiAgcHJvdmlkZXJE\
aXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAg\
ZGVzY3JpcHRpb246IERlcGxveXMgT3BlblNoaWZ0IFN0YXJ0ZXIgV29ya3Nob3AgSW5mcmFzdHJ1\
Y3R1cmUKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVm\
YXVsdAogICAgcGFyYW1ldGVyczoKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXIKICAgICAgdGl0\
bGU6IFVzZXJuYW1lCiAgICAgIGRlc2NyaXB0aW9uOiBVc2VyIGlzIHJlcXVpcmVkIGZvciBjcmVh\
dGluZyBwcm9qZWN0IGFkbWluIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6\
IE9wZW5TaGlmdCBVc2VyCiAgICAtIG5hbWU6IG9wZW5zaGlmdF9wYXNzd29yZAogICAgICB0aXRs\
ZTogUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246IFBhc3N3b3JkIGlzIHJlcXVpcmVkIGZvciBj\
cmVhdGluZyBwcm9qZWN0IGFkbWluIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
cmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICBkaXNwbGF5\
X2dyb3VwOiBPcGVuU2hpZnQgVXNlcgogICAgLSBuYW1lOiB3b3Jrc2hvcF90eXBlCiAgICAgIHRp\
dGxlOiBXb3Jrc2hvcCB0eXBlCiAgICAgIGRlc2NyaXB0aW9uOiBUeXBlIG9mIHdvcmtzaG9wIHRv\
IGRlbGl2ZXIgKEphdmEsIFB5dGhvbiwgbm9kZS5qcykKICAgICAgdHlwZTogZW51bQogICAgICBl\
bnVtOiBbJ2phdmEnLCAncHl0aG9uJywgJ25vZGUuanMnLCAncGhwJ10KICAgICAgcmVxdWlyZWQ6\
IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBzZWxlY3QKICAgICAgZGVmYXVsdDogamF2YQogICAg\
ICBkaXNwbGF5X2dyb3VwOiBXb3Jrc2hvcAogICAgLSBuYW1lOiB1c2VyX2NvdW50CiAgICAgIHRp\
dGxlOiBOdW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgIGRlc2NyaXB0aW9uOiBOdW1iZXIgb2Yg\
cGFydGljaXBhbnRzIGZvciB0aGUgd29ya3Nob3AuIFRoZXJlIHdpbGwgYmUgcHJvdmlzaW9uZWQg\
aW5mcmFzdHJ1Y3R1cmUvcHJvamVjdCBmb3IgZWFjaCBwYXJ0aWNpcGFudAogICAgICB0eXBlOiBu\
dW1iZXIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AK\
ICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXJfcGFzc3dvcmQKICAgICAgdGl0bGU6IE9wZW5TaGlm\
dCBVc2VyIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgT3BlblNoaWZ0IHBhc3N3b3Jk\
IGZvciBwYXJ0aWNpcGFudHMgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFy\
dGljaXBhbnRzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBk\
aXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGVmYXVsdDogInIzZGg0dDEhIgogICAgICBkaXNwbGF5\
X2dyb3VwOiBXb3Jrc2hvcAogICAgLSBuYW1lOiBvcGVuc2hpZnRfbWFzdGVyX3VybAogICAgICB0\
aXRsZTogT3BlblNoaWZ0IE1hc3RlciBVUkwKICAgICAgZGVzY3JpcHRpb246IFRoZSBhZGRyZXNz\
IHRvIE9wZW5TaGlmdCBtYXN0ZXIgVVJMIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgbGFiIGd1aWRl\
IHRvIHBhcnRpY2lwYW50cwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUK\
ICAgICAgZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYiBHdWlkZQog\
ICAgLSBuYW1lOiBnb2dzX2FkbV91c2VyCiAgICAgIHRpdGxlOiBHb2dzIEFkbWluIFVzZXIKICAg\
ICAgZGVzY3JpcHRpb246IEFkbWluIHVzZXIgZm9yIEdvZ3MgR2l0IFNlcnZlcgogICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgZGVmYXVsdDogImdvZ3NhZG1pbiIKICAgICAgcmVxdWlyZWQ6IHRydWUK\
ICAgICAgZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IEdpdCBTZXJ2ZXIK\
ICAgIC0gbmFtZTogZ29nc19hZG1fcGFzc3dvcmQKICAgICAgdGl0bGU6IEdvZ3MgQWRtaW4gUGFz\
c3dvcmQKICAgICAgZGVzY3JpcHRpb246IEFkbWluIHBhc3N3b3JkIGZvciBHb2dzIEdpdCBTZXJ2\
ZXIKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6ICJyM2RoNHQxISIKICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6\
IEdpdCBTZXJ2ZXIK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
